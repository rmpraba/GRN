<link rel="import" href="../../bower_components/iron-form/iron-form.html">
<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../../bower_components/paper-menu/paper-menu.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/iron-input/iron-input.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../../bower_components/paper-tab/paper-tab.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../bower_components/iron-collapse/iron-collapse.html">
<link rel="import" href="../../bower_components/paper-styles/demo-pages.html">
<meta name="viewport" content="width=device-width, initial-scale=1">
<dom-module id="autocompleteitemlist-card">
  <style>
    .repeatcard{
      @apply(--layout-vertical);
      width: 120%;

    }
    paper-listbox{
      width: 100%;
      background-color: #e5efe2;
      box-shadow: rgba(0, 0, 0, 0.0980392) 5px 5px 4px, rgba(0, 0, 0, 0.0980392) 0px 0px 10px;
    }
    paper-input{
      width: 100%;
    //margin-top: -6%;
    }
  </style>
  <template>

    <div class="repeatcard">
      <paper-input value="{{value}}" on-keydown="changed"></paper-input>
      <paper-listbox class="dropdown-content" on-iron-select="selected">
        <template is="dom-repeat" items="{{itemArray}}" as="item">
          <paper-item>{{item.itemdes}}</paper-item>
        </template>
      </paper-listbox>

    </div>
    <iron-ajax
      auto
      id="itemlistreadajax"
      url="{{url}}"

      handle-as="json"
      content-type="application/json"
      on-response="itemlistreadResponse">
    </iron-ajax>

  </template>

  <script>
    (function() {
      this.val="";

      var item=[];
      //var item=["abc","abcdf","abchyj","abyu","adfgdf","gjgj","bjhd","beytr","bhsdgfg","hsgdf","jhgfdh","sada","aasdgdfg","gdhjss","gghfgj","bmhujser","cjgfrgg"];
      Polymer({is:"autocompleteitemlist-card",
        ready:function(){
          this.url="../../config/items.json";
          this.itemval="";
          this.unit="";
          this.querySelector('paper-listbox').style.visibility='hidden';
        },
        selected:function(e){


          //document.querySelector('item-card').setUnit(this.unit);
          if(e.target.selectedItem.textContent.trim()!="No items found"){
            this.value=e.target.selectedItem.textContent.trim();

            for(var i=0;i<item.length;i++){
              if(item[i].name==this.value)
                this.unit=item[i].unit;
            }
            document.querySelector('item-page').setMenuinfo(this.value,this.unit);
          }
          else{
            alert("Please choose valid item...");
            this.value="";
          }
          this.querySelector('paper-listbox').style.visibility='hidden';
          this.querySelector('paper-listbox').selected=-1;
          this.itemArray="";
        },
        changed:function(e){
          var arr=[];
          this.querySelector('paper-listbox').style.visibility='visible';
          if(e.keyCode==8){
            var len=(this.value).length;
            if(len<=1){
              this.querySelector('paper-listbox').style.visibility='hidden';
              this.itemArray="";
              this.itemval="";
            }
            if(len>1){
              this.querySelector('paper-listbox').style.visibility='visible';
              var backsubval=((this.value).substring(0,(len-1))).trim();
              for(var i=0;i<item.length;i++)
              {
                var subval=((item[i].name).trim()).substring(0,backsubval.length);
                if(subval==backsubval)
                {
                  var obj={"itemdes":""};
                  obj.itemdes=item[i].name;
                  arr.push(obj);
                }
              }
              this.itemArray=arr;
            }
          }
          if(e.keyCode!=8){
            this.itemval = this.itemval +String.fromCharCode((e.keyCode+32));
            if(this.itemval.length>0)
            {
              for(var i=0;i<item.length;i++){
                var subval=((item[i].name).trim()).substring(0,this.itemval.length);

                if(subval==this.itemval)
                {
                  var obj={"itemdes":""};
                  obj.itemdes=item[i].name;
                  arr.push(obj);
                }
              }
              if(arr.length>0)
                this.itemArray=arr;
              else
              {
                var obj={"itemdes":""};
                obj.itemdes="No items found";
                arr.push(obj);
                this.itemArray=arr;
              }
            }
          }
        },
        itemlistreadResponse:function(e)
        {
          //var arr=e.detail.response;
          //alert(e.detail.response);
          item=e.detail.response.items;
          //alert(JSON.stringify(item[0].name));
        },
        setDefaultval:function(){
          this.value="";
          document.querySelector('item-page').setItemdes(this.value);
        }
      });
    })();
  </script>

</dom-module>
