<link rel="import" href="../../bower_components/iron-form/iron-form.html">
<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../../bower_components/paper-menu/paper-menu.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/iron-input/iron-input.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../../bower_components/paper-tab/paper-tab.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../physicqualify-service/physicqualify-service.html">
<link rel="import" href="../physicqualifyitem-card/physicqualifyitem-card.html">
<link rel="import" href="../datepicker-card/datepicker-card.html">
<meta name="viewport" content="width=device-width, initial-scale=1">
<dom-module id="physicqualify-card">
  <template>
    <style>
      ::-webkit-scrollbar {
        display: none;
      }
      .repeatcard{
        @apply(--layout-horizontal);
        width: 90%;

      }

      #card1{
        margin-top: 0.5%;
        border-radius: 2px;
        box-shadow: rgba(0, 0, 0, 0.0980392) 5px 5px 4px, rgba(0, 0, 0, 0.0980392) 0px 0px 10px;
        width: 100%;
      //margin-left:10%;
      //height:50%;
        background-color:white;
        border:2px solid #bcd6b3;
      //border-color:#dbe9d6;
        overflow-x:hidden;
      }

      .topright{
        @apply(--layout-horizontal);
        width: 100%;
        margin-left: 7%;
        margin-top: -5%;
      }
      .topright1{
        @apply(--layout-horizontal);
        width: 100%;
        margin-top: 0%;
      }
      .set{
        @apply(--layout-horizontal);
        margin-left:10%;
      }
      paper-tabs{
        background-color: #e5efe2;
        width: 95%;
        margin-left: 2%;
        height: 5%;
        margin-top: 5%;
      }
      paper-button{
        text-transform:none;
      }
      #div2{
        margin-top: 0%;
      }
      datepicker-card{
        width: 30%;
      }
      .polbl{
        margin-left:17%;
      }
      .podate{
        font-size:12px;
      }
      #supplier{
        margin-left:3%;
      }
      #pinput{
        margin-left: 5%;
      }
    </style>
    <div class="card" id="card1">

      <template is="dom-repeat" items="{{mainArray}}" as="item">
        <div class="polbl"><paper-item class="podate">PO Date</paper-item></div>
        <div class="topright">
          <datepicker-card></datepicker-card>
          <paper-input  name="ponumber" label="PO Number"  value="{{pono}}" required auto-validate id="pono" error-message="Enter PO Number!" on-change="changed" readonly="{{read}}"></paper-input>
          <paper-input  name="supplier" label="Supplier Name" id="supplier" value="{{item.supname}}" readonly></paper-input>
        </div>
    </div>
  </template>
  <paper-tabs selected="0" noink id="ptab">
    <paper-tab><paper-button on-tap="">Product ID</paper-button></paper-tab>
    <!--<paper-tab><paper-button on-tap="">Qty Ordered</paper-button></paper-tab>-->
    <paper-tab><paper-button on-tap="">Qty Received</paper-button></paper-tab>
    <paper-tab><paper-button on-tap="">Qty Accepted</paper-button></paper-tab>
    <paper-tab><paper-button on-tap="">Remarks</paper-button></paper-tab>
  </paper-tabs>
  <div id="div2">
    <template is="dom-repeat" items="{{itemArray}}" as="item">
      <div class="repeatcard">
        <physicqualifyitem-card inwardno="{{inwardno}}" ponumber="{{ponumber}}" podate="{{podate}}" suppliername="{{suppliername}}" itemdes="{{item.itemdes}}" qtyreceived="{{item.qtyreceived}}" qtyaccepted="{{item.qtyaccepted}}" remarks="{{item.remarks}}"></physicqualifyitem-card>
      </div>
    </template>

  </div>
  </div>


  <iron-ajax
    id="physicqualifyitemreadajax"
    url="{{url}}"
    method="post"
    params='{{param}}'
    handle-as="json"
    content-type="application/json"
    on-response="physicqualifyitemreadResponse">
  </iron-ajax>
  </template>
  <script>
    Polymer({is:"physicqualify-card",
      ready:function(){

        if(sessionStorage.getItem("loggedrole")=="Stores manager"){
          this.read = false;
        }
        if(sessionStorage.getItem("loggedrole")=="Production manager"||sessionStorage.getItem("loggedrole")=="Quality manager"||sessionStorage.getItem("loggedrole")=="Purchase manager"){
          this.read = true;
        }

        this.url=sessionStorage.getItem("curr_sess_url")+"physicqualify-card";

        /*if(this.pono!=""||this.pono!=null)
         alert("yes");
         else
         alert("no");*/
      },
      changed:function(e){

        localStorage.setItem("curr_sess_POchangeflag","1");
        localStorage.setItem("curr_sess_PONumber",this.pono);
        //this.ponumber=this.pono;
      },
      setPodate:function(){
        //alert('calling');
        this.podate=localStorage.getItem("localsess_curr_inwarddate");
        //alert(this.podate);
      },
      physicqualifyreadService:function(inwardregno){
        this.inwardno=inwardregno;

        var arg={"inwardregno":"","status":""};
        arg.inwardregno=inwardregno;

        if(sessionStorage.getItem("loggedrole")=="Stores manager"){
          arg.status="New";
        }
        if(sessionStorage.getItem("loggedrole")=="Production manager"){
          arg.status="Draft";
        }
        else if(sessionStorage.getItem("loggedrole")=="Quality manager"){
          arg.status="physicqualified";
        }
        else if(sessionStorage.getItem("loggedrole")=="Purchase manager"){
          arg.status="qualified";
        }

        this.param=arg;
        this.url=sessionStorage.getItem("curr_sess_url")+"physicqualify-card";
        this.$.physicqualifyitemreadajax.generateRequest();
      },
      physicqualifyitemreadResponse:function(e)
      {
        var arr=e.detail.response;
        var commarr=[];
        var prodarr=[];
        var potempflag="";
        for(var i=0;i<arr.length;i++)
        {
          var obj={"inwardno":"","inwarddate":"","ponumber":"","podate":"","supname":""};
          obj.inwardno=arr[i].inwardno;
          obj.inwarddate=arr[i].inwarddate;
          obj.ponumber=arr[i].ponumber;
          if(arr[i].ponumber!=null||arr[i].ponumber!="")
            potempflag=arr[i].ponumber;
          obj.podate=arr[i].podate;
          obj.supname=arr[i].supname;
        }
        commarr.push(obj);
        for(var i=0;i<arr.length;i++)
        {
          var obj={"itemdes":"","qtyordered":"","qtyreceived":"","qtyaccepted":"","remarks":""};
          obj.itemdes=arr[i].itemdes;
          obj.qtyordered=arr[i].qtyordered;
          obj.qtyreceived=arr[i].qtyreceived;
          if(sessionStorage.getItem("loggedrole")=="Stores manager"){
            obj.qtyaccepted=arr[i].qtyreceived;
          }
          if(sessionStorage.getItem("loggedrole")=="Production manager"||sessionStorage.getItem("loggedrole")=="Quality manager"||sessionStorage.getItem("loggedrole")=="Purchase manager"){
            obj.qtyaccepted=arr[i].qtyaccepted;
          }
          obj.remarks=arr[i].remarks;
          prodarr.push(obj);
        }
        this.mainArray=commarr;
        this.itemArray=prodarr;
        this.pono=potempflag;
        this.ponumber=potempflag;
        localStorage.setItem("curr_sess_PONumber",potempflag);
        this.suppliername=commarr[0].supname;
        //alert(JSON.stringify(commarr));
        //alert(JSON.stringify(prodarr));
      }
    });
  </script>

</dom-module>
